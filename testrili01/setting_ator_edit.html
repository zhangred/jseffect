<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, width=device-width">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta content="black" name="apple-mobile-web-app-status-bar-style">
	<meta name="format-detection" content="telephone=no">
	<meta content="telephone=no" name="format-detection">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<link rel="stylesheet" href="assets/stylesheets/style.css" type="text/css" /> 
	<title>协作者详情</title>
</head>
<body>
	<div class="toptilline">
		<p class="til">协作者详情</p>
		<a class="tl-back" id="J_back"></a>
	</div>
	<div class="html atoredit" id="J_html">
		<div class="editlinebox editlinebox-nmt" id="J_list">
			<div class="editline">
				<p class="el-ado">协作者称呼</p>
				<p class="el-input"><input type="text" name="" value="小张" placeholder="请填写" class="el-ctrol" id="J_name"></p>
			</div>
			<div class="editline">
				<p class="el-ado">协作者手机账号</p>
				<p class="el-text el-text-dis">15821670480</p>
			</div>
			<div class="editline editline-full">
				<p class="el-ado">协作房间</p>
				<p class="el-text el-text-sm">已选<span class="el-text-in" id="J_num">2</span>间</span></p>
				<div class="rooms">
					<a href="javascript:;" class="J_rm rm rm-active" data-rid="1">龙阳101</a>
					<a href="javascript:;" class="J_rm rm rm-active" data-rid="2">龙阳888</a>
					<a href="javascript:;" class="J_rm rm" data-rid="3">静安106</a>
					<a href="javascript:;" class="J_rm rm" data-rid="4">龙阳贵宾1号</a>
					<a href="javascript:;" class="J_rm rm" data-rid="5">静安总统套房208</a>
					<a href="javascript:;" class="J_rm rm" data-rid="6">静安总统套房207</a>
				</div>
			</div>
		</div>
	</div>
	<div class="botbtnline">
		<a href="javascript:;" id="J_save" class="btn">保存</a>
	</div>


	<script language="javascript" type="text/javascript" src="assets/javascript/jquery-2.1.4.min.js"></script>
	<script language="javascript" type="text/javascript" src="assets/javascript/func.js"></script>
	<script type="text/javascript">
		$(function(){

			var locked = false;//设置开关 防止重复提交;
			var data = {"id":1,"name":"小张","phone":"15821670480","rooms":[1,2]}; // 预定义提交数据
			

			$('.J_rm').click(function(){
				var self = $(this),
					rid = parseInt(self.attr('data-rid'));

				if(self.hasClass('rm-active')){
					var idx = data.rooms.indexOf(rid);
					data.rooms.splice(idx,1);
					self.removeClass('rm-active')
				}else{
					data.rooms.push(rid);
					self.addClass('rm-active')
				}
				$('#J_num').html(data.rooms.length)
			});

			//保存
			var J_save = $('#J_save');
		   	J_save.click(function(){
		   		if(locked){ return;}

		   		var name = $('#J_name').val().trim();
		   		if(!name){
					CUES.tip({"msg":"请填写协作者称呼"})
					return;
				};
				   
		   		if(data.rooms.length==0){
		   			CUES.tip({"msg":"请选择协作房间"})
		   			return;
		   		};

				data.name = name;
		   		locked = true;
				J_save.html('正在提交···');
				console.log(data)
		   		//保存提交数据
				$.ajax({ 
					type: "GET",
					url: "api/callback.json?v="+(new Date().getTime()),
					data: {},
					dataType: "json",
					success: function(res){
						if(res.code==0){
							CUES.tip({"msg":"提交成功","callback":function(){
								window.history.go(-1);
							}})
						}
					},
					complete:function(){
						locked = false;
						J_save.html('提交');
					}
				});

			});

		});
	</script>
</body>
</html>
