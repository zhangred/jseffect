<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, width=device-width">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta content="black" name="apple-mobile-web-app-status-bar-style">
	<meta name="format-detection" content="telephone=no">
	<meta content="telephone=no" name="format-detection">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<link rel="stylesheet" href="assets/stylesheets/style.css" type="text/css" /> 
	<title>新增协作者</title>
</head>
<body>
	<div class="toptilline">
		<p class="til">新增协作者</p>
		<a class="tl-back" id="J_back"></a>
	</div>
	<div class="html atoredit" id="J_step1">
		<div class="editlinebox editlinebox-nmt">
			<div class="editline">
				<p class="el-ado">协作者称呼</p>
				<p class="el-input"><input type="text" name="" placeholder="请填写" class="el-ctrol" id="J_name"></p>
			</div>
			<div class="editline">
				<p class="el-ado">协作者手机账号</p>
				<p class="el-input"><input type="text" name="" placeholder="请填写" class="el-ctrol" id="J_phone"></p>
			</div>
		</div>
		<div class="botbtnline">
			<a href="javascript:;" id="J_next" class="btn">下一步</a>
		</div>
	</div>
	<div class="html atoredit" id="J_step2" style="display:none">
		<div class="editlinebox editlinebox-nmt">
			<div class="editline editline-full">
				<p class="el-ado">协作房间</p>
				<p class="el-text el-text-sm">已选<span class="el-text-in" id="J_num">0</span>间</span></p>
				<div class="rooms">
					<a href="javascript:;" class="J_rm rm" data-rid="1">龙阳101</a>
					<a href="javascript:;" class="J_rm rm" data-rid="2">龙阳888</a>
					<a href="javascript:;" class="J_rm rm" data-rid="3">静安106</a>
					<a href="javascript:;" class="J_rm rm" data-rid="4">龙阳贵宾1号</a>
					<a href="javascript:;" class="J_rm rm" data-rid="5">静安总统套房208</a>
					<a href="javascript:;" class="J_rm rm" data-rid="6">静安总统套房207</a>
				</div>
			</div>
		</div>
		<div class="botbtnline">
			<a href="javascript:;" id="J_save" class="btn">确认</a>
		</div>
	</div>
	


	<script language="javascript" type="text/javascript" src="assets/javascript/jquery-2.1.4.min.js"></script>
	<script language="javascript" type="text/javascript" src="assets/javascript/func.js"></script>
	<script type="text/javascript">
		$(function(){

			var locked = false,//设置开关 防止重复提交;
				data = {"rooms":[]}; // 预定义提交数据

			var regphone = /^[1][0-9]{10}$/ig;

			var J_name = $('#J_name'),
				J_phone = $('#J_phone'),
				J_step1 = $('#J_step1'),
				J_step2 = $('#J_step2'),
				J_next = $('#J_next'),
				J_save = $('#J_save');

			J_next.click(function(){
				var name = J_name.val().trim(),
					phone = J_phone.val().trim();
				
				if(!name){
					CUES.tip({"msg":"请填写协作者称呼"})
					return;
				}
				if(!regphone.test(phone)){
					CUES.tip({"msg":"协作者手机账号不正确"})
					return;
				};
				locked = true;
				J_next.html('正在校验中···');
				console.log(data)
		   		//保存提交数据
				$.ajax({ 
					type: "GET",
					url: "api/callback.json?v="+(new Date().getTime()),
					data: {},
					dataType: "json",
					success: function(res){
						if(res.code==0){
							data.name = name;
							data.phone = phone;

							J_step1.hide();
							J_step2.fadeIn();
						}else{
							CUES.alert({"msg":"您输入的手机号未查到对应的账号，请检查是否有误。"})
						}
					},
					complete:function(){
						locked = false;
						J_next.html('下一步');
					}
				});
			});
			

			$('.J_rm').click(function(){
				var self = $(this),
					rid = parseInt(self.attr('data-rid'));

				if(self.hasClass('rm-active')){
					var idx = data.rooms.indexOf(rid);
					data.rooms.splice(idx,1);
					self.removeClass('rm-active')
				}else{
					data.rooms.push(rid);
					self.addClass('rm-active')
				}
				$('#J_num').html(data.rooms.length)
			});

			//保存
			var J_save = $('#J_save');
		   	J_save.click(function(){
		   		if(locked){ return;}
				   
		   		if(data.rooms.length==0){
		   			CUES.tip({"msg":"请选择协作房间"})
		   			return;
		   		};

		   		locked = true;
				J_save.html('正在提交···');
				console.log(data)
		   		//保存提交数据
				$.ajax({ 
					type: "GET",
					url: "api/callback.json?v="+(new Date().getTime()),
					data: {},
					dataType: "json",
					success: function(res){
						if(res.code==0){
							CUES.tip({"msg":"提交成功","callback":function(){
								window.history.go(-1);
							}})
						}
					},
					complete:function(){
						locked = false;
						J_save.html('确认');
					}
				});

			});

		});
	</script>
</body>
</html>
