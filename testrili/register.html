<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, width=device-width">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta content="black" name="apple-mobile-web-app-status-bar-style">
	<meta name="format-detection" content="telephone=no">
	<meta content="telephone=no" name="format-detection">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<link rel="stylesheet" href="assets/stylesheets/style.css" type="text/css" /> 
	<title>欢迎注册满格</title>
</head>
<body>
	<div class="html register" id="J_reg">
		<p class="logo"><img src="assets/images/icon_logo.png" class="logo-ico"></p>
		<p class="til">手机号码</p>
		<p class="input"><input type="text" placeholder="请输入" id="J_phone" class="ctrol"></p>
		<p class="til">验证码</p>
		<p class="input">
			<input type="text" placeholder="请输入" class="ctrol" id="J_yzm">
			<a href="javascript:;" class="yzm" id="J_yzmbtn">获取验证码</a>
		</p>
		<a href="javascript:;" class="btn" id="J_btn">立即注册</a>
		<p class="bottx">现在注册，即可免费使用</p>
	</div>
	<div class="html register" id="J_state" style="display:none;">
		<p class="logo"><img src="assets/images/icon_logo.png" class="logo-ico"></p>
		<p class="text">恭喜您，您已加入满格大家庭<br>现在去使用满格吧</p>
		<a href="" class="btn btna">前往安装</a>
	</div>


	<script language="javascript" type="text/javascript" src="assets/javascript/jquery-2.1.4.min.js"></script>
	<script language="javascript" type="text/javascript" src="assets/javascript/func.js"></script>
	<script type="text/javascript">
		$(function(){			

			var J_phone = $('#J_phone'),
				J_yzm = $('#J_yzm'),
				J_yzmbtn = $('#J_yzmbtn'),
				J_btn = $('#J_btn'),
				locked = false,
				backtime = 60,
				inter = '',
				data = {};

			J_yzmbtn.click(function(){ // 发送验证码
				if(backtime!=60||locked){ return false;};
				var regphone = /^[1][0-9]{10}$/ig;
				if(!regphone.test(J_phone.val().trim())){
					CUES.tip({"msg":"手机号不正确","type":"tip"});
					return false;
				};
				locked = true;
				$.ajax({ // 发送验证码ajax
					type: "GET",
					url: "api/callback.json?v="+(new Date().getTime()),
					data: {},
					dataType: "json",
					success: function(res){
						if(res.code==0){
							backtime = 59;
							J_yzmbtn.html('重新获取(59)');
							inter = setInterval(function(){
								backtime--;
								if(backtime==0){
									clearInterval(inter);
									backtime = 60;
									J_yzmbtn.html("获取验证码");
								}else{
									J_yzmbtn.html('重新获取('+backtime+')');
								}
							},1000);
						}
					},
					complete:function(){
						locked = false;
					}
				});
			});

			//注册
			J_btn.click(function(){
		   		if(locked){ return;}

				var regphone = /^[1][0-9]{10}$/ig,
					phone = J_phone.val().trim(),
					yzm = J_yzm.val().trim();

				if(!regphone.test(phone)){
					CUES.tip({"msg":"手机号不正确","type":"tip"});
					return false;
				};
				   
		   		if(!yzm){
		   			CUES.tip({"msg":"请输入验证码"})
		   			return;
		   		};

				data.phone = phone;
				data.yzm = yzm;

		   		locked = true;
				J_btn.html('正在注册···');
				console.log(data)
		   		//保存提交数据
				$.ajax({ 
					type: "GET",
					url: "api/callback.json?v="+(new Date().getTime()),
					data: {},
					dataType: "json",
					success: function(res){
						if(res.code==0){
							$('#J_reg').hide();
							$('#J_state').show();
						}
					},
					complete:function(){
						locked = false;
						J_btn.html('立即注册');
					}
				});

			});
		});
	</script>
</body>
</html>
